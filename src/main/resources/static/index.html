<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Network Bank</title>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, select {
      display: block;
      margin-bottom: 10px;
      padding: 8px;
      background-color: #2c2c2c;
      color: white;
      border: none;
      width: 300px;
    }
    button {
      padding: 10px;
      background-color: #555;
      color: white;
      border: none;
      cursor: pointer;
    }
    .section {
      margin-top: 40px;
    }
  </style>
</head>
<body>
<h1>Network Bank</h1>

<div class="section">
  <h2>Cadastro de Usuário</h2>
  <input id="nome" placeholder="Nome completo" />
  <input id="cpf" placeholder="CPF" />
  <input id="dataNascimento" placeholder="Data de nascimento" type="date" />
  <input id="telefone" placeholder="Telefone" />
  <select id="tipoUsuario">
    <option value="CLIENTE">Cliente</option>
    <option value="FUNCIONARIO">Funcionário</option>
  </select>
  <input id="senhaHash" placeholder="Senha" type="password" />
  <button onclick="cadastrarUsuario()">Cadastrar</button>
  <p id="cadastroMsg"></p>
</div>

<div class="section">
  <h2>Consulta de Saldo por CPF</h2>
  <input id="cpfConsulta" placeholder="Digite o CPF" />
  <button onclick="consultarSaldo()">Consultar Saldo</button>
  <p id="saldoMsg"></p>
</div>

<div class="section">
  <h2>Depósito por CPF</h2>
  <input id="cpfDeposito" placeholder="Digite o CPF" />
  <input id="valorDeposito" placeholder="Valor do depósito" />
  <button onclick="realizarDeposito()">Depositar</button>
  <p id="depositoMsg"></p>
</div>

<script>
  async function cadastrarUsuario() {
    const usuario = {
      nome: document.getElementById("nome").value,
      cpf: document.getElementById("cpf").value,
      dataNascimento: document.getElementById("dataNascimento").value,
      telefone: document.getElementById("telefone").value,
      tipoUsuario: document.getElementById("tipoUsuario").value,
      senhaHash: document.getElementById("senhaHash").value
    };

    const cliente = { usuario };

    try {
      const res = await fetch("http://localhost:8080/clientes", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(cliente)
      });

      if (!res.ok) throw await res.json();

      const data = await res.json();
      document.getElementById("cadastroMsg").textContent = `Usuário cadastrado com sucesso! ID: ${data.usuario.idUsuario}`;
    } catch (err) {
      document.getElementById("cadastroMsg").textContent = `Erro ao cadastrar usuário: Usuario já existente!`;
    }
  }

  async function consultarSaldo() {
    const cpf = document.getElementById("cpfConsulta").value;
    try {
      const res = await fetch(`http://localhost:8080/contas/saldo?cpf=${cpf}`);
      if (!res.ok) throw await res.json();

      const saldo = await res.json();
      document.getElementById("saldoMsg").textContent = `Saldo: R$ ${saldo}`;
    } catch (err) {
      document.getElementById("saldoMsg").textContent = `Erro ao consultar saldo: Conta não existente!`;
    }
  }

  async function realizarDeposito() {
    const cpf = document.getElementById("cpfDeposito").value;
    const valor = document.getElementById("valorDeposito").value;
    try {
      const response = await fetch(`http://localhost:8080/contas/depositar?cpf=${cpf}&valor=${valor}`, {
        method: 'POST'
      });

      if (!response.ok) {
        const errorText = await response.text(); // ← evita tentar ler JSON
        throw new Error(errorText);
      }

      const mensagem = await response.text();
      alert(mensagem);
    } catch (error) {
      alert("Erro ao realizar depósito: " + error.message);
    }
  }
</script>
</body>
</html>
